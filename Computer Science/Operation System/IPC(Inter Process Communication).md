# IPC(Inter Process Communication)

## 프로세스 복습

### 프로세스란?

> 디스크에 저장되어 있던 프로그램이 메모리에 적재되어 운영체제의 제어를 받는 상태이자 실행되고 있는 프로그램

<br/>

### 프로세스의 주소 공간

> 프로세스는 각각 독립된 메모리 영역을 할당 받음 (Code, Stack, Heap, Data)

<br/>

## IPC란?

- 프로세스들 사이에 서로 데이터를 주고받는 행위 또는 그에 대한 방법이나 경로
- 내부 프로세스간 통신에도 그 상황에 맞는 IPC 설비를 선택할 필요

<br/>

## IPC 종류

### 익명 PIPE

![image](https://user-images.githubusercontent.com/24283422/125092200-0edaa780-e10c-11eb-8c87-3ddc5ab19c60.png)

- 두 개의 프로세스를 하나의 PIPE로 연결
- 하나의 프로세스는 write only, 다른 하나는 read only
- 반이중 통신 : 한쪽 방향으로만 통신 가능
- 장점 : 매우 간단하게 사용 가능
- 단점 : 양쪽으로 모두 송/수신을 하고 싶으면 2개의 파이프를 만들어야 함 -> 구현 복잡

<br/>

### Named PIPE(FIFO)

- 익명 파이프는 통신할 프로세스를 명확히 알 수 있는 경우에 사용 ex) 부모-자식 프로세스
- Named 파이프는 전혀 모르는 상태의 프로세스들 사이 통신에 사용
- 장점 : 부모 프로세스와 무관한 다른 프로세스도 통신이 가능
  - 이유 : 프로세스 통신을 위해 이름이 있는 파일을 사용하기 때문
- 단점 : 읽기/쓰기 동시에 불가능, 전이중 통신을 위해서는 익명 파이프처럼 2개 만들어야 함 -> 구현 복잡

<br/>

### Message Queue

- 입출력 방식은 Named 파이프와 동일
- Named PIPE와 다른 점 : Name PIPE가 데이터의 흐름이라면 메시지 큐는 메모리 공간
- 장점 : 사용할 데이터에 번호를 붙이면서 여러 프로세스가 동시에 데이터를 쉽게 다룰 수 있음

<br/>

### 공유 메모리

- 파이프, 메시지 큐가 통신을 이용한 설비라면, 공유 메모리는 데이터 자체를 공유하도록 지원하는 설비
- 스레드처럼 프로세스간 메모리 영역을 공유해서 사용할 수 있도록 허용
- 동작 방식
  - 프로세스가 공유 메모리 할당을 커널에 요청
  - 커널은 해당 프로세스에 메모리 공간을 할당
  - 모든 프로세스는 해당 메모리 영역에 접근 가능
- 중개자 없이 곧바로 메모리에 접근할 수 있어서 IPC 중에 가장 빠르게 작동

<br/>

### 메모리 맵

- 공유 메모리처럼 메모리를 공유
- 열린 파일을 메모리에 맵핑시켜서 공유하는 방식
  - 공유 매개체 = 파일+메모리
- 주로 파일로 대용량 데이터를 공유해야 할 때 사용

<br/>

### 소켓

- 네트워크 소켓 통신을 통해 데이터를 공유하는 방식
- 클라이언트와 서버가 소켓을 통해서 통신하는 구조로, 원격에서 프로세스 간 데이터를 공유할 때 사용
- 서버(bind, listen, accept), 클라이언트(connect)

<br/>

> 이러한 IPC 통신에서 프로세스 간 데이터를 동기화하고 보호하기 위해 세마포어와 뮤텍스를 사용한다. (공유된 자원에 한번에 하나의 프로세스만 접근시킬 때)

<br/>

### Q. 프로세스 메모리를 공유하면 안되나요? (= IPC가 왜 필요한가요?)

![image](https://user-images.githubusercontent.com/24283422/125088739-afc76380-e108-11eb-8616-c90a3d5301e1.png)

> 프로세스 메모리를 공유한다고 가정하면

1. 프로세스1에서 프로세스2의 데이터 필요
2. 프로세스1 중단(대기)
3. 프로세스2 실행 중 프로세스1의 MyFunc 주소 변경
4. 프로세스2 종료
5. 프로세스1 다시 실행 중 MyFunc 에서 엉뚱한 주소 호출

> 그래서 커널은 프로세스마다 독립적으로 메모리를 할당하고, 프로세스끼리 메모리를 접근할 수 없도록 함!

<br/>

## 출처

- https://m.blog.naver.com/PostView.naver?isHttpsRedirect=true&blogId=akj61300&logNo=80126199990
- https://jwprogramming.tistory.com/54
